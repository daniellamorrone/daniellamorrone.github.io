<HTML>

<HEAD>
<TITLE>Distance Calculator</TITLE>
<META name="description"
content="Distance Calculator">

<SCRIPT LANGUAGE="JAVASCRIPT">

<!-- hide this script tag's contents from old browsers
// Copyright 1997 Ed Williams. All rights reserved

decpl=4  // Dec places of minutes output
//**************CD****************
function ClearFormCD(){

    document.InputFormCD.lat1.value = "0:00.00";
    document.InputFormCD.lat2.value = "0:00.00";
    document.InputFormCD.lon1.value = "0:00.00";
    document.InputFormCD.lon2.value = "0:00.00";
    document.OutputFormCD.crs12.value = "";
    document.OutputFormCD.crs21.value = "";
    document.OutputFormCD.d12.value = "";


}

function ComputeFormCD(){
    //get select  values
var signlat1,signlat2,signlon1,signlon2,dc
var lat1,lat2,lon1,lon2
var d,crs12,crs21
var argacos
var a,invf
  /* Input and validate data */
signlat1=signlatlon(document.InputFormCD.NS1)
signlat2=signlatlon(document.InputFormCD.NS2)
signlon1=signlatlon(document.InputFormCD.EW1)
signlon2=signlatlon(document.InputFormCD.EW2)


lat1=(Math.PI/180)*signlat1*checkField(document.InputFormCD.lat1)
lat2=(Math.PI/180)*signlat2*checkField(document.InputFormCD.lat2)
lon1=(Math.PI/180)*signlon1*checkField(document.InputFormCD.lon1)
lon2=(Math.PI/180)*signlon2*checkField(document.InputFormCD.lon2)

//alert("lat1=" + lat1 + "lon1=" + lon1 +"\nlat2=" +lat2+ "lon2="+lon2)

dc=dconv(document.OutputFormCD.Dunit) /* get distance conversion factor */
//alert("dc=" +dc)

ellipse=getEllipsoid(document.OutputFormCD.Model) //get ellipse
//showProps(ellipse,"ellipse")

if (ellipse.name=="Sphere"){
  // spherical code
  cd=crsdist(lat1,lon1,lat2,lon2) // compute crs and distance 
  crs12 =cd.crs12*(180/Math.PI)
  crs21 =cd.crs21*(180/Math.PI)
  d=cd.d*(180/Math.PI)*60*dc  // go to physical units  
  } else {
  // elliptic code
  cde=crsdist_ell(lat1,-lon1,lat2,-lon2,ellipse)  // ellipse uses East negative
  crs12 =cde.crs12*(180/Math.PI)  
  crs21 =cde.crs21*(180/Math.PI)
  d=cde.d*dc  // go to physical units
  }

//alert("d="+d+"  crs12="+crs12+"   crs21="+crs21)
document.OutputFormCD.crs12.value=crs12
document.OutputFormCD.crs21.value=crs21
document.OutputFormCD.d12.value=d
}

function crsdist(lat1,lon1,lat2,lon2){ // radian args
/* compute course and distance (spherical) */

if ((lat1+lat2==0.) && (Math.abs(lon1-lon2)==Math.PI)
                    && (Math.abs(lat1) != (Math.PI/180)*90.)){
    alert("Course between antipodal points is undefined")
    }

with (Math){

  d=acos(sin(lat1)*sin(lat2)+cos(lat1)*cos(lat2)*cos(lon1-lon2))

  if ((d==0.) || (lat1==-(PI/180)*90.)){
     crs12=2*PI
  } else if (lat1==(PI/180)*90.){
     crs12=PI
  } else {
     argacos=(sin(lat2)-sin(lat1)*cos(d))/(sin(d)*cos(lat1))
     if (sin(lon2-lon1) < 0){       
       crs12=acosf(argacos)    
     }
     else{
       crs12=2*PI-acosf(argacos)    
     }
  }
  if ((d==0.) || (lat2==-(PI/180)*90.)){
     crs21=0.
  } else if (lat2==(PI/180)*90.){
     crs21=PI
  }else{
     argacos=(sin(lat1)-sin(lat2)*cos(d))/(sin(d)*cos(lat2))
     if (sin(lon1-lon2)<0){       
       crs21=acosf(argacos)    
     }
     else{
       crs21=2*PI-acosf(argacos)    
     }
  }
}
out=new MakeArray(0)
out.d=d
out.crs12=crs12
out.crs21=crs21
return out
}

function crsdist_ell(glat1,glon1,glat2,glon2,ellipse){
// glat1 initial geodetic latitude in radians N positive 
// glon1 initial geodetic longitude in radians E positive 
// glat2 final geodetic latitude in radians N positive 
// glon2 final geodetic longitude in radians E positive 
a=ellipse.a
f=1/ellipse.invf
//alert("a="+a+" f="+f)
var r, tu1, tu2, cu1, su1, cu2, s1, b1, f1
var x, sx, cx, sy, cy,y, sa, c2a, cz, e, c, d
var EPS= 0.00000000005
var faz, baz, s
var iter=1
var MAXITER=100
  if ((glat1+glat2==0.) && (Math.abs(glon1-glon2)==Math.PI)){
    alert("Course and distance between antipodal points is undefined")
    glat1=glat1+0.00001 // allow algorithm to complete
    }
  if (glat1==glat2 && (glon1==glon2 || Math.abs(Math.abs(glon1-glon2)-2*Math.PI) <  EPS)){
    alert("Points 1 and 2 are identical- course undefined")
    out=new MakeArray(0)
    out.d=0
    out.crs12=0
    out.crs21=Math.PI
    return out
  }
  r = 1 - f
  tu1 = r * Math.tan (glat1)
  tu2 = r * Math.tan (glat2)
  cu1 = 1. / Math.sqrt (1. + tu1 * tu1)
  su1 = cu1 * tu1
  cu2 = 1. / Math.sqrt (1. + tu2 * tu2)
  s1 = cu1 * cu2
  b1 = s1 * tu2
  f1 = b1 * tu1
  x = glon2 - glon1
  d = x + 1 // force one pass
  while ((Math.abs(d - x) > EPS) && (iter < MAXITER))
    {
      iter=iter+1
      sx = Math.sin (x)
//       alert("sx="+sx)
      cx = Math.cos (x)
      tu1 = cu2 * sx
      tu2 = b1 - su1 * cu2 * cx
      sy = Math.sqrt(tu1 * tu1 + tu2 * tu2)
      cy = s1 * cx + f1
      y = atan2 (sy, cy)
      sa = s1 * sx / sy
      c2a = 1 - sa * sa
      cz = f1 + f1
      if (c2a > 0.)
	cz = cy - cz / c2a
      e = cz * cz * 2. - 1.
      c = ((-3. * c2a + 4.) * f + 4.) * c2a * f / 16.
      d = x
      x = ((e * cy * c + cz) * sy * c + y) * sa
      x = (1. - c) * x * f + glon2 - glon1
    }
  faz = modcrs(atan2(tu1, tu2))
  baz = modcrs(atan2(cu1 * sx, b1 * cx - su1 * cu2) + Math.PI)
  x = Math.sqrt ((1 / (r * r) - 1) * c2a + 1)
  x +=1
  x = (x - 2.) / x
  c = 1. - x
  c = (x * x / 4. + 1.) / c
  d = (0.375 * x * x - 1.) * x
  x = e * cy
  s = ((((sy*sy*4.-3.)*(1.-e-e)*cz*d/6.-x)*d/4.+cz)*sy*d+y)*c*a*r
  out=new MakeArray(0)
  out.d=s
  out.crs12=faz
  out.crs21=baz
  if (Math.abs(iter-MAXITER)<EPS){
    alert("Algorithm did not converge")
  }
  return out

}


// -- done hiding from old browsers -->

</SCRIPT>
</HEAD>

<BODY>
<CENTER>
<H1>Great Circle Calculator.</H1>
</CENTER>

<CENTER><H3>By Ed Williams</H3></CENTER>
<P> You need Javascript enabled if you want this page to do anything useful!
For Netscape, it's under Options/Network Preferences/Languages.
</P>
<H3> <A NAME="CrsDist">Compute true course and distance between points.</A> </H3>

<P> Enter lat/lon of points, select distance units and earth model and click
"compute". Lat/lons may be entered in DD.DD, DD:MM.MM or
DD:MM:SS.SS formats.</P>
<p> Note that if either point is very close to a pole,
the course may be inaccurate, because of its extreme sensitivity to position
and inevitable rounding error. </P>

<CENTER>
<FORM NAME="InputFormCD" method=POST>
<TABLE border=1>
<TR>
<TD COLSPAN=2><DIV ALIGN=CENTER>Lat1</DIV></TD>

<TD COLSPAN=2><DIV ALIGN=CENTER>Lon1</DIV></TD>
<CAPTION> Input Data
</TR>
<TR>
<TD><INPUT TYPE=TEXT NAME=lat1  SIZE=10 value="0:00.00"  ></TD>
<TD><SELECT Name="NS1">
   <OPTION SELECTED>N<OPTION>S</SELECT></TD>
<TD><INPUT TYPE=TEXT NAME=lon1 SIZE=10 value="0:00.00"></TD>
<TD><SELECT Name="EW1">
   <OPTION SELECTED>W<OPTION>E</SELECT></TD>
</TR>
<TR>
<TD COLSPAN=2><DIV ALIGN=CENTER>Lat2</DIV></TD>

<TD COLSPAN=2><DIV ALIGN=CENTER>Lon2</DIV></TD>

</TR>
<TR>
<TD><INPUT TYPE=TEXT NAME=lat2 SIZE=10 value="0:00.00"  ></TD>
<TD><SELECT Name="NS2">
   <OPTION SELECTED>N<OPTION>S</SELECT></TD>
<TD><INPUT TYPE=TEXT NAME=lon2 SIZE=10 value="0:00.00"></TD>
<TD><SELECT Name="EW2">
   <OPTION SELECTED>W<OPTION>E</SELECT></TD>
</TR>
</TABLE>
</FORM>
<P></P>
<P></P>


<FORM NAME="OutputFormCD" method=POST>
<TABLE border=1>
<TR>
<TD><DIV ALIGN=CENTER>Course 1-2</DIV></TD>
<TD><DIV ALIGN=CENTER>Course 2-1</DIV></TD>
<TD><DIV ALIGN=CENTER>Distance</DIV></TD>
</TR>
<TR>
<TD><INPUT TYPE=TEXT NAME=crs12  SIZE=8 ></TD>
<TD><INPUT TYPE=TEXT NAME=crs21  SIZE=8 ></TD>
<TD><INPUT TYPE=TEXT NAME=d12    SIZE=9 ></TD>
</TR>
<CAPTION> Output
</TABLE>
</CENTER>
<P></P>

<P> Distance Units: 
<SELECT Name="Dunit">
   <OPTION>nm<OPTION SELECTED>km<OPTION>sm<OPTION>ft</SELECT>
    Earth model:
<SELECT Name="Model">
   <OPTION SELECTED>WGS84/NAD83/GRS80
</SELECT>
</P>
<P>
<INPUT TYPE="button" VALUE="Compute" onClick="ComputeFormCD()">
<INPUT TYPE="button"  VALUE="Reset" onClick="ClearFormCD()">

</P>
</FORM>
<HR>

</FORM>


<P></P>
</FORM>

</BODY>
</HTML>
